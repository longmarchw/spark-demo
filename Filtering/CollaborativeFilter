//算法名称-协同过滤(CollaborativeFilter)
import cn.neucloud.dasuan.SparkContextImpl
import cn.neucloud.dasuan.analysis.filtering.CFALS
import org.apache.spark.sql.types.{StructField, _}
import org.apache.spark.sql.{DataFrame, Row, SQLContext}
val sqlContext = new SQLContext(sc)
//数据准备
val ranks = Array(12) //List(8, 12)
val lambdas = Array(0.1) //List(0.1, 10.0)
val numIters = Array(20) //List(10, 20)
val mo = new CFALS(sc)
val ratingsData = ("1::1193::5::978300760\n1::661::3::978302109\n1::914::3::978301968\n1::3408::4::978300275" +
  "\n1::2355::5::978824291\n1::1197::3::978302268\n1::1287::5::978302039\n1::2804::5::978300719" +
  "\n1::594::4::978302268\n1::919::4::978301368\n1::595::5::978824268\n1::938::4::978301752" +
  "\n1::2398::4::978302281\n1::2918::4::978302124\n1::1035::5::978301753\n1::2791::4::978302188\n1::2687::3::978824268" +
  "\n1::2018::4::978301777\n1::3105::5::978301713\n1::2797::4::978302039\n1::2321::3::978302205\n1::720::3::978300760" +
  "\n1::1270::5::978300055\n1::527::5::978824195\n1::2340::3::978300103\n1::48::5::978824351\n1::1097::4::978301953\n1::1721::4::978300055" +
  "\n1::1545::4::978824139\n1::745::3::978824268\n1::2294::4::978824291\n1::3186::4::978300019\n1::1566::4::978824330\n1::588::4::978824268" +
  "\n1::1907::4::978824330\n1::783::4::978824291\n1::1836::5::978300172\n1::1022::5::978300055\n1::2762::4::978302091\n1::150::5::978301777" +
  "\n1::1::5::978824268\n1::1961::5::978301590\n1::1962::4::978301753\n1::2692::4::978301570\n1::260::4::978300760\n1::1028::5::978301777\n1::1029::5::978302205" +
  "\n1::1207::4::978300719\n1::2028::5::978301619\n1::531::4::978302149\n1::3114::4::978302174\n1::608::4::978301398\n1::1246::4::978302091\n2::1357::5::978298709" +
  "\n2::3068::4::978299000\n2::1537::4::978299620\n2::647::3::978299351\n2::2194::4::978299297\n2::648::4::978299913\n2::2268::5::978299297\n2::2628::3::978300051" +
  "\n2::1103::3::978298905\n2::2916::3::978299809\n2::3468::5::978298542\n2::1210::4::978298151\n2::1792::3::978299941\n2::1687::3::978300174\n2::1213::2::978298458" +
  "\n2::3578::5::978298958\n2::2881::3::978300002\n2::3030::4::978298434\n2::1217::3::978298151\n2::3105::4::978298673\n2::434::2::978300174\n2::2126::3::978300123" +
  "\n2::3107::2::978300002\n2::3108::3::978299712\n2::3035::4::978298625\n2::1253::3::978299120\n2::1610::5::978299809\n2::292::3::978300123\n2::2236::5::978299220" +
  "\n2::3071::4::978299120\n2::902::2::978298905\n2::368::4::978300002\n2::1259::5::978298841\n2::3147::5::978298652\n2::1544::4::978300174\n2::1293::5::978298261" +
  "\n2::1188::4::978299620\n2::3255::4::978299321\n2::3256::2::978299839\n2::3257::3::978300073\n2::110::5::978298625\n2::2278::3::978299889\n2::2490::3::978299966" +
  "\n2::1834::4::978298813\n2::3471::5::978298814\n2::589::4::978299773\n2::1690::3::978300051\n2::3654::3::978298814\n2::2852::3::978298958\n2::1945::5::978298458" +
  "\n2::982::4::978299269\n2::1873::4::978298542\n2::2858::4::978298434\n2::1225::5::978298391\n2::2028::4::978299773\n2::515::5::978298542\n2::442::3::978300025" +
  "\n2::2312::3::978299046\n2::265::4::978299026\n2::1408::3::978299839\n2::1084::3::978298813\n2::3699::2::978299173\n2::480::5::978299809\n2::1442::4::978299297" +
  "\n2::2067::5::978298625\n2::1265::3::978299712\n2::1370::5::978299889\n2::1193::5::978298413\n2::1801::3::978300002\n2::1372::3::978299941\n2::2353::4::978299861" +
  "\n2::3334::4::978298958\n2::2427::2::978299913\n2::590::5::978299083\n2::1196::5::978298730\n2::1552::3::978299941\n2::736::4::978300100\n2::1198::4::978298124" +
  "\n2::593::5::978298517\n2::2359::3::978299666\n2::95::2::978300143\n2::2717::3::978298196\n2::2571::4::978299773\n2::1917::3::978300174\n2::2396::4::978299641" +
  "\n2::3735::3::978298814\n2::1953::4::978298775\n2::1597::3::978300025\n2::3809::3::978299712\n2::1954::5::978298841\n2::1955::4::978299200\n2::235::3::978299351" +
  "\n2::1124::5::978299418\n2::1957::5::978298750\n2::163::4::978299809\n2::21::1::978299839\n2::165::3::978300002\n2::2321::3::978299666\n2::1090::2::978298580" +
  "\n2::380::5::978299809\n2::2501::5::978298600\n2::349::4::978299839\n2::457::4::978299773\n2::1096::4::978299386\n2::920::5::978298775\n2::459::3::978300002" +
  "\n2::1527::4::978299839\n2::3418::4::978299809\n2::1385::3::978299966\n2::3451::4::978298924\n2::3095::4::978298517\n2::780::3::978299966\n2::498::3::978299418" +
  "\n2::2728::3::978298881\n2::2002::5::978300100\n2::1962::5::978298813\n2::1784::5::978298841\n2::2943::4::978298372\n2::2006::3::978299861\n2::318::5::978298413" +
  "\n2::1207::4::978298478\n2::1968::2::978298881\n2::3678::3::978299250\n2::1244::3::978299143\n2::356::5::978299686\n2::1245::2::978299200\n2::1246::5::978299418" +
  "\n2::3893::1::978299535\n2::1247::5::978298652\n3::3421::4::978298147\n3::1641::2::978298430\n3::648::3::978297867\n3::1394::4::978298147\n3::3534::3::978297068" +
  "\n3::104::4::978298486\n3::2735::4::978297867\n3::1210::4::978297600\n3::1431::3::978297095\n3::3868::3::978298486\n3::1079::5::978298296\n3::2997::3::978298147" +
  "\n3::1615::5::978297710\n3::1291::4::978297600\n3::1259::5::978298296\n3::653::4::978297757\n3::2167::5::978297600\n3::1580::3::978297663\n3::3619::2::978298201" +
  "\n3::260::5::978297512\n3::2858::4::978297039\n3::3114::3::978298103\n3::1049::4::978297805\n3::1261::1::978297663\n3::552::4::978297837\n3::480::4::978297690" +
  "\n3::1265::2::978298316\n3::1266::5::978297396\n3::733::5::978297757\n3::1196::4::978297539\n3::590::4::978297439\n3::2355::5::978298430\n3::1197::5::978297570\n" +
  "3::1198::5::978297570\n3::1378::5::978297419\n3::593::3::978297018\n3::1379::4::978297419\n3::3552::5::978298459\n3::1304::5::978298166\n3::1270::3::978298231" +
  "\n3::2470::4::978297777\n3::3168::4::978297570\n3::2617::2::978297837\n3::1961::4::978297095\n3::3671::5::978297419\n3::2006::4::978297757\n3::2871::4::978297539" +
  "\n3::2115::4::978297777\n3::1968::4::978297068\n3::1136::5::978298079\n3::2081::4::978298504\n4::3468::5::978294008\n4::1210::3::978293924\n4::2951::4::978294282\n" +
  "4::1214::4::978294260\n4::1036::4::978294282\n4::260::5::978294199\n4::2028::5::978294230\n4::480::4::978294008\n4::1196::2::978294199\n4::1198::5::978294199\n" +
  "4::1954::5::978294282\n4::1097::4::978293964\n4::3418::4::978294260\n4::3702::4::978294260\n4::2366::4::978294230\n4::1387::5::978294199\n4::3527::1::978294008" +
  "\n4::1201::5::978294230\n4::2692::5::978294230\n4::2947::5::978294230\n4::1240::5::978294260\n5::2987::4::978243170\n5::2333::4::978242607\n5::1175::5::978244759" +
  "\n5::39::3::978245037\n5::288::2::978246585\n5::2337::5::978243121\n5::1535::4::978245513\n5::1392::4::978245645\n5::2268::2::978246033\n5::1466::3::978245695\n" +
  "5::860::2::978244493\n5::1683::3::978246108\n5::866::4::978245334\n5::1684::3::978244540\n5::2916::1::978245645\n5::2770::4::978241981\n5::215::3::978245422\n" +
  "5::1759::4::978245513\n5::501::1::978244001\n5::3578::2::978243803\n5::506::4::978245999\n5::1250::5::978241112\n5::3793::2::978243170\n5::509::4::978245829\n" +
  "5::41::4::978244692\n5::1610::4::978245645\n5::2058::1::978245740\n5::3799::3::978243937\n5::2997::5::978241556\n5::47::3::978245334\n5::2700::4::978243085\n" +
  "5::296::4::978244177\n5::581::3::978244808\n5::1617::3::978244025\n5::728::4::978244759\n5::299::3::978242934\n5::3079::2::978246162\n5::2560::4::978242977\n" +
  "5::1909::3::978246479\n5::150::2::978245763\n5::224::3::978245829\n5::3728::2::978244568\n5::229::3::978246528\n5::6::2::978245916\n5::3006::3::978245422\n" +
  "5::2858::4::978241390\n5::1046::5::978244114\n5::515::4::978245891\n5::800::2::978244540\n5::50::5::978244205\n5::52::2::978246479\n5::1191::2::978246426\n" +
  "5::1192::5::978244493\n5::733::1::978245763\n5::3081::3::978243054\n5::377::4::978245999\n5::2353::3::978245790\n5::1268::2::978245948\n5::3083::5::978244114\n" +
  "5::2427::5::978246450\n5::3513::1::978243896\n5::2428::3::978242541\n5::2355::5::978241981\n5::2282::3::978244667\n5::3514::2::978243869\n5::1554::3::978244540" +
  "\n5::1912::3::978244624\n5::593::4::978244177\n5::2359::3::978245568\n5::2716::3::978242607\n5::1485::3::978246576\n5::2717::1::978241072\n5::2571::5::978244493" +
  "\n5::2289::4::978244568\n5::162::4::978244624\n5::1127::1::978241390\n5::3016::4::978242016\n5::2070::2::978243121\n5::1704::3::978244517\n5::3163::5::978244852" +
  "\n5::2437::2::978244759\n5::2291::5::978244808\n5::1635::4::978245314\n5::1279::1::978245314\n5::2721::3::978243121\n5::2723::4::978242788\n5::1921::4::978246162" +
  "\n5::2725::2::978246162\n5::1923::3::978245314\n5::2580::4::978242607\n5::3386::2::978245948\n5::3744::1::978243896\n5::968::3::978242847\n5::896::4::978244493" +
  "\n5::3020::1::978245916\n5::1788::3::978244603\n5::318::3::978244177\n5::176::4::978244568\n5::461::3::978244893\n5::608::4::978244177\n5::1429::3::978245829" +
  "\n5::2159::1::978244808\n5::1715::4::978245891\n5::1643::3::978245916\n5::3249::1::978245916\n5::3176::2::978243085\n5::1719::3::978244205\n5::2806::2::978243085" +
  "\n5::2734::2::978242788\n5::1649::4::978244667\n5::321::3::978245863\n5::2013::3::978242934\n5::3100::1::978245645\n5::2952::2::978245790\n5::1213::5::978244177" +
  "\n5::1794::3::978245966\n5::2599::5::978242323\n5::1500::3::978245314\n5::3105::2::978246576\n5::2959::4::978242541\n5::1509::3::978244962\n5::1721::1::978245763" +
  "\n5::1722::2::978246108\n5::1650::3::978245314\n5::908::4::978241072\n5::1580::4::978245999\n5::1653::2::978245891\n5::2384::3::978245708\n5::1729::4::978245763" +
  "\n5::3476::3::978245916\n5::2890::4::978245445\n5::3113::1::978242323\n5::2028::2::978244053\n5::16::3::978245645\n5::265::3::978245037\n5::2029::4::978246555" +
  "\n5::194::3::978246108\n5::551::4::978246504\n5::1513::4::978242977\n5::3046::3::978244962\n5::2318::4::978242640\n5::1517::4::978245568\n5::1089::5::978244205" +
  "\n5::3260::4::978245065\n5::913::5::978242740\n5::1730::4::978244603\n5::3408::3::978242323\n5::3409::3::978242541\n5::2607::2::978242607\n5::1449::4::978244830" +
  "\n5::1732::5::978245740\n5::1733::3::978246450" +
  "\n5::2390::4::978242679\n5::1734::4::978245334\n5::3266::2::978246162\n5::3267::4::978244893").split("\n")

val ratiingRDD = sc.parallelize(ratingsData).map(Row(_)).cache()
val fields = Seq(
  StructField("long", StringType, true)
)
val schema = StructType(fields)
val tickerOb = sqlContext.createDataFrame(ratiingRDD,schema)
val model1 = mo.trainALS(tickerOb, ranks, lambdas, numIters)

